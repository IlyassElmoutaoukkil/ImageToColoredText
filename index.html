<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <div style="display: flex;height:100vh">
        <div style="width:50%;padding:20px;text-align:center;display:grid">
            <img src="image.png" id="image" alt="" style="height: auto;width:20%;">
            <input type="file" id="image_input" onchange="putImage()">
            <div>
                <label for="text">Text</label>
                <input name="text" id="text_area" name="" id="" cols="30" rows="10" value='i'>
            </div>
            <div>
                <label for="letter_spacing">Letter spacing</label>
                <input name="letter_spacing" type="range" value="10" min="2" max="20" id="letter_spacing_slider">
            </div>
            <div>
                <label for="letter_size">Letter size</label>
                <input name="letter_size" type="range" value="22" min="2" max="30" id="letter_size_slider">
            </div>
            <div>
                <label  for="line_height">Line height</label>
                <input name="line_height" type="range" value="1" min="-10" max="10" id="line_height_slider">
            </div>
            <div>
                <label  for="letter_weight">Letter Weight</label>
                <input name="letter_weight" type="range" value="500" min="100" max="900" id="letter_weight_slider">
            </div>
        </div>
    
        <div id="canvas_container" style="width:50%;display: flex;">
            <div id="disp" style="margin:auto;font-weight: 500;letter-spacing:2px; font-size:20px;line-height: 8px;width:min-content;height:auto;border: 2px gray;" >
                
            </div>
            <canvas  id="canvas" style="height:100%;width:100%;display: block;display: none;">
            
            </canvas>
        </div>
        
    </div>
    
</body>

<script>
    // setting everthing up

    // read the image 

    // convert it to a matrix of RGB colors

    // get the text 

    // find how to give a litter a color;

    
 
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    sizing_ratio = 2;
    image_height = 60
    image_width = 60

    function showImage(src, target) {
        var fr = new FileReader();
        fr.onload = function (e) { target.src = this.result; draw() };
        fr.readAsDataURL(src.files[0]);        
    }

    function putImage() {
        var src = document.getElementById("image_input");
        var target = document.getElementById("image");
        showImage(src, target);
    }

    function draw(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        var image = new Image();
        
        image.onload = function(){
            console.log('image loaded')
            ctx.drawImage(
                image, 0, 0,    
                image_width, 
                image_height
            );


            text = ''
            var text_value = document.getElementById("text_area").value;

            t=0
            
            for (let y = 0; y < image_height; y=y+1) {
                    for (let x = 0; x < image_width; x=x+1) {
                        t++
                        var c = ctx.getImageData(x, y, 2, 3).data;
                        if((text_value.length)>t){
                            if(text_value[t]==' '){
                                letter = '-'
                            }else{
                                var letter =  text_value[t]
                            }
                        }else{
                            var letter = text_value[0]
                            t=-1
                        }

                        text = text+`<a style="color:rgb(${c[0]},${c[1]},${c[2]},${c[3]})">${letter}</a>`
                        if(x==(image_width-1)){
                            text = text+' '
                        }
                    }
            }
            document.getElementById("disp").innerHTML=text;
        };


        image.src = document.getElementById('image').getAttribute('src');
        
    }

    window.onload = function(){
        draw()
    }
    
    document.getElementById("text_area").onchange = function(){
        draw()
    }


    text = ''


    var letter_spacing_value = document.getElementById("letter_spacing_slider");
    var letter_size_value = document.getElementById("letter_size_slider");
    var line_height_value = document.getElementById("line_height_slider");
    var letter_weight_value = document.getElementById("letter_weight_slider");

    // Update the current slider value (each time you drag the slider handle)
    letter_spacing_value.oninput = function() {
        this.value;
        document.getElementById("disp").style.lineHeight = this.value+'px'
    }

    letter_size_value.oninput = function() {
        this.value;
        document.getElementById("disp").style.fontSize = this.value+'px'
    }

    line_height_value.oninput = function() {
        this.value;
        document.getElementById("disp").style.letterSpacing = this.value+'px'
    }

    letter_weight_value.oninput = function() {
        this.value;
        document.getElementById("disp").style.fontWeight = this.value+'px'
    }

</script>
</html>